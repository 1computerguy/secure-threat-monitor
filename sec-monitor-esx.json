{
    "variables": {
        "version": "0.1.0",
        "description": "PhotonOS Appliance",
        "vm_name": "PhotonOS_Appliance",
        "iso_checksum": "93d0cde8da51f9208713d895b5b85b86980d2a72e710f55f0e65bc82c299dd9a7ebedc8f30d5f4d18c1a389c76a961e8a14b02416692204d31d77e1e4792f37d",
        "iso_checksum_type": "sha512",
        "iso_url": "http://dl.bintray.com/vmware/photon/3.0/GA/iso/photon-3.0-26156e2.iso",
        "numvcpus": "2",
        "ramsize": "4096",
        "guest_username": "root",
        "guest_password": "VMware1!",
        "photon_ovf_template": "photon.xml.template",
        "ovftool_deploy_vcenter": "192.168.30.200",
        "ovftool_deploy_vcenter_username": "administrator@vsphere.local",
        "ovftool_deploy_vcenter_password": "VMware1!",
        "builder_host": "192.168.30.14",
        "builder_host_username": "root",
        "builder_host_password": "VMware1!",
        "builder_host_datastore": "sm-vsanDatastore",
        "builder_host_portgroup": "VM Network"
    },
    "builders": [
      {
        "type": "vmware-iso",
        "vm_name": "{{ user `vm_name` }}",
        "guest_os_type": "Other",
        "version": "13",
        "disk_size": "12288",
        "boot_command": [
          "<esc><wait>",
          "vmlinuz initrd=initrd.img root=/dev/ram0 loglevel=3 ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/photon-kickstart.json photon.media=cdrom",
          "<enter>"
        ],
        "boot_wait": "10s",
        "headless": false,
        "vnc_disable_password": true,
        "iso_url": "{{ user `iso_url` }}",
        "iso_checksum": "{{ user `iso_checksum` }}",
        "iso_checksum_type": "{{ user `iso_checksum_type` }}",
        "http_directory": "http",
        "remote_type": "esx5",
        "remote_host": "{{ user `builder_host` }}",
        "remote_datastore": "{{ user `builder_host_datastore` }}",
        "remote_username": "{{ user `builder_host_username` }}",
        "remote_password": "{{ user `builder_host_password` }}",
        "ssh_username": "{{ user `guest_username` }}",
        "ssh_password": "{{ user `guest_password` }}",
        "ssh_port": 22,
        "ssh_wait_timeout": "60m",
        "format": "ovf",
        "shutdown_command": "/sbin/shutdown -h now",
        "shutdown_timeout": "1000s",
        "vmx_data": {
          "numvcpus": "{{ user `numvcpus` }}",
          "memsize": "{{ user `ramsize` }}",
          "ethernet0.networkName": "{{ user `builder_host_portgroup` }}",
          "ethernet0.present": "TRUE",
          "ethernet0.startConnected": "TRUE",
          "ethernet0.virtualDev": "vmxnet3",
          "ethernet0.addressType": "generated",
          "ethernet0.wakeOnPcktRcv": "FALSE",
          "annotation": "Version: {{ user `version` }}"
        }
      }
    ],
    "provisioners": [
      {
        "type": "shell",
        "scripts": [
          "scripts/photon-settings.sh",
          "scripts/photon-cleanup.sh"
        ]
      },
      {
        "type": "file",
        "source": "files/rc.local",
        "destination": "/etc/rc.d/rc.local"
      },
      {
        "type": "file",
        "source": "files/setup.sh",
        "destination": "/root/setup.sh"
      }
    ],
    "post-processors": [
      {
        "type": "shell-local",
        "environment_vars": ["PHOTON_VERSION={{ user `version` }}", "PHOTON_APPLIANCE_NAME={{ user `vm_name` }}", "FINAL_PHOTON_APPLIANCE_NAME={{ user `vm_name` }}_{{user `version`}}", "PHOTON_OVF_TEMPLATE={{ user `photon_ovf_template` }}"],
        "inline": [
          "cd manual",
          "./add_ovf_properties.sh"
        ]
      },
      {
        "type": "shell-local",
        "inline": [
          "pwsh -F unregister_vm.ps1 {{ user `ovftool_deploy_vcenter` }} {{ user `ovftool_deploy_vcenter_username` }} {{ user `ovftool_deploy_vcenter_password` }} {{ user `vm_name` }}"
        ]
      }
    ]
  }
  
  